(this["webpackJsonp@rclone/rclone-webui-react"]=this["webpackJsonp@rclone/rclone-webui-react"]||[]).push([[17],{306:function(e,t,a){"use strict";var n=a(5),s=a(6),i=a(0),r=a.n(i),o=a(3),l=a.n(o),c=a(34),d=a.n(c),u=a(26),h=["className","cssModule","color","body","inverse","outline","tag","innerRef"],m={tag:u.q,inverse:l.a.bool,color:l.a.string,body:l.a.bool,outline:l.a.bool,className:l.a.string,cssModule:l.a.object,innerRef:l.a.oneOfType([l.a.object,l.a.string,l.a.func])},p=function(e){var t=e.className,a=e.cssModule,i=e.color,o=e.body,l=e.inverse,c=e.outline,m=e.tag,p=e.innerRef,g=Object(s.a)(e,h),f=Object(u.m)(d()(t,"card",!!l&&"text-white",!!o&&"card-body",!!i&&(c?"border":"bg")+"-"+i),a);return r.a.createElement(m,Object(n.a)({},g,{className:f,ref:p}))};p.propTypes=m,p.defaultProps={tag:"div"},t.a=p},307:function(e,t,a){"use strict";var n=a(5),s=a(6),i=a(0),r=a.n(i),o=a(3),l=a.n(o),c=a(34),d=a.n(c),u=a(26),h=["className","cssModule","innerRef","tag"],m={tag:u.q,className:l.a.string,cssModule:l.a.object,innerRef:l.a.oneOfType([l.a.object,l.a.string,l.a.func])},p=function(e){var t=e.className,a=e.cssModule,i=e.innerRef,o=e.tag,l=Object(s.a)(e,h),c=Object(u.m)(d()(t,"card-body"),a);return r.a.createElement(o,Object(n.a)({},l,{className:c,ref:i}))};p.propTypes=m,p.defaultProps={tag:"div"},t.a=p},333:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return r}));var n=a(2),s=a(284);const i=()=>e=>{Object(s.getAllProviders)().then(t=>e({type:n.y,payload:t.providers}))},r=()=>e=>{Object(s.getAllConfigDump)().then(t=>e({type:n.u,status:n.L,payload:t}),t=>e({type:n.u,status:n.J,payload:t}))}},377:function(e,t,a){"use strict";var n=a(5),s=a(6),i=a(0),r=a.n(i),o=a(3),l=a.n(o),c=a(34),d=a.n(c),u=a(26),h=["className","cssModule","valid","tooltip","tag"],m={children:l.a.node,tag:u.q,className:l.a.string,cssModule:l.a.object,valid:l.a.bool,tooltip:l.a.bool},p={tag:"div",valid:void 0},g=function(e){var t=e.className,a=e.cssModule,i=e.valid,o=e.tooltip,l=e.tag,c=Object(s.a)(e,h),m=o?"tooltip":"feedback",p=Object(u.m)(d()(t,i?"valid-"+m:"invalid-"+m),a);return r.a.createElement(l,Object(n.a)({},c,{className:p}))};g.propTypes=m,g.defaultProps=p,t.a=g},549:function(e,t,a){"use strict";var n,s=a(5),i=a(6),r=a(276),o=a(13),l=a(88),c=a(0),d=a.n(c),u=a(3),h=a.n(u),m=a(34),p=a.n(m),g=a(308),f=a(26),v=["tag","isOpen","className","navbar","cssModule","children","innerRef"];function b(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function E(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?b(Object(a),!0).forEach((function(t){Object(l.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):b(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var O=E(E({},g.Transition.propTypes),{},{isOpen:h.a.bool,children:h.a.oneOfType([h.a.arrayOf(h.a.node),h.a.node]),tag:f.q,className:h.a.node,navbar:h.a.bool,cssModule:h.a.object,innerRef:h.a.oneOfType([h.a.func,h.a.string,h.a.object])}),N=E(E({},g.Transition.defaultProps),{},{isOpen:!1,appear:!1,enter:!0,exit:!0,tag:"div",timeout:f.e.Collapse}),S=((n={})[f.d.ENTERING]="collapsing",n[f.d.ENTERED]="collapse show",n[f.d.EXITING]="collapsing",n[f.d.EXITED]="collapse",n);function y(e){return e.scrollHeight}var j=function(e){function t(t){var a;return(a=e.call(this,t)||this).state={height:null},["onEntering","onEntered","onExit","onExiting","onExited"].forEach((function(e){a[e]=a[e].bind(Object(r.a)(a))})),a}Object(o.a)(t,e);var a=t.prototype;return a.onEntering=function(e,t){this.setState({height:y(e)}),this.props.onEntering(e,t)},a.onEntered=function(e,t){this.setState({height:null}),this.props.onEntered(e,t)},a.onExit=function(e){this.setState({height:y(e)}),this.props.onExit(e)},a.onExiting=function(e){e.offsetHeight;this.setState({height:0}),this.props.onExiting(e)},a.onExited=function(e){this.setState({height:null}),this.props.onExited(e)},a.render=function(){var e=this,t=this.props,a=t.tag,n=t.isOpen,r=t.className,o=t.navbar,l=t.cssModule,c=t.children,u=(t.innerRef,Object(i.a)(t,v)),h=this.state.height,m=Object(f.o)(u,f.c),b=Object(f.n)(u,f.c);return d.a.createElement(g.Transition,Object(s.a)({},m,{in:n,onEntering:this.onEntering,onEntered:this.onEntered,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}),(function(t){var n=function(e){return S[e]||"collapse"}(t),i=Object(f.m)(p()(r,n,o&&"navbar-collapse"),l),u=null===h?null:{height:h};return d.a.createElement(a,Object(s.a)({},b,{style:E(E({},b.style),u),className:i,ref:e.props.innerRef}),c)}))},t}(c.Component);j.propTypes=O,j.defaultProps=N,t.a=j},664:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a(0),i=a.n(s),r=a(375),o=a(376),l=a(43),c=a(288),d=a(377),u=a(272),h=a(62),m=a(549),p=a(306),g=a(307),f=a(296),v=a(665),b=a(648),E=a(649),O=a(650),N=a(89);class S extends i.a.Component{constructor(e){super(e),this.toggle=this.toggle.bind(this)}toggle(){this.props.closeModal()}render(){const{isVisible:e}=this.props;return i.a.createElement("div",null,i.a.createElement(N.a,null,i.a.createElement(v.a,{isOpen:e,toggle:this.toggle},i.a.createElement(b.a,{toggle:this.toggle,"data-test":"modalHeader"},"Configuring your drive."),i.a.createElement(E.a,{"data-test":"modalBody"},"A page will open for you with the authentication for your drive. This modal will automatically dismiss upon successful creation"),i.a.createElement(O.a,{"data-test":"modalFooter"},i.a.createElement(f.a,{color:"primary",onClick:this.toggle},"Done")," "))))}}S.defaultProps={isVisible:!0};var y=S,j=a(64),C=a(63),x=a(331),V=a.n(x);const k=(e,t)=>{const a=t.trim().toLowerCase(),n=a.length;return 0===n?e:0===n?[]:e.filter(e=>e.Description.toLowerCase().slice(0,n)===a)},w=e=>e.Prefix,P=e=>i.a.createElement("div",null,e.Description);class I extends i.a.Component{constructor(e){super(e),this.onSuggestionsFetchRequested=e=>{let{value:t}=e;this.setState({suggestions:k(this.props.suggestions,t)})},this.onSuggestionsClearRequested=()=>{this.setState({suggestions:[]})},this.state={suggestions:[]}}render(){const{value:e,onChange:t,suggestions:a}=this.props,n=Object(C.f)(a,e);let s="";s=void 0===n?e:n.Description;const r={placeholder:"Type a provider type",value:s,onChange:t};return i.a.createElement(V.a,{suggestions:this.state.suggestions,onSuggestionsFetchRequested:this.onSuggestionsFetchRequested,onSuggestionsClearRequested:this.onSuggestionsClearRequested,getSuggestionValue:w,renderSuggestion:P,alwaysRenderSuggestions:!0,highlightFirstSuggestion:!0,inputProps:r})}}var T=I,M=a(36),A=a(333),R=a(87),D=a(35),q=a(45);function F(e){let{drivePrefix:t,loadAdvanced:a,changeHandler:n,currentValues:s,isValidMap:u,errorsMap:h,config:m}=e;if(void 0!==t&&""!==t){const e=Object(C.f)(m,t);let p=[];if(void 0!==e){p=e.Options.map((e,t)=>{if(0===e.Hide&&(a&&e.Advanced||!a&&!e.Advanced)){const a="".concat(e.Help),m=e.Required?i.a.createElement("i",{className:"text-red"},"*"):null,p=!Object(C.j)(e.Examples);let g=null,f="";return e.IsPassword?f="password":p?f="string":"bool"===e.Type?(f="select",g=[i.a.createElement("option",{key:1,value:!0},"Yes"),i.a.createElement("option",{key:2,value:!1},"No")]):f="int"===e.Type?"number":(e.Type,"text"),i.a.createElement(r.a,{key:t,row:!0},i.a.createElement(o.a,{for:e.Name,sm:5},a,m),i.a.createElement(l.a,{sm:7},i.a.createElement(c.a,{type:f,value:s[e.Name],name:e.Name,valid:u[e.Name],invalid:!u[e.Name],id:e.Name,onChange:n,required:e.Required},g),i.a.createElement(d.a,null,h[e.Name])))}return null})}return p}return i.a.createElement("div",null,"Select a drive type to continue")}function H(e){let{key:t,id:a,label:n,changeHandler:s,type:u,value:h,name:m,placeholder:p,isValid:g=!1}=e;return i.a.createElement(r.a,{key:t,row:!0},i.a.createElement(o.a,{for:a,sm:5},n),i.a.createElement(l.a,{sm:7},i.a.createElement(c.a,{type:u,value:h,name:m,placeholder:p,id:a,onChange:s,valid:g,invalid:!g,required:!0}),i.a.createElement(d.a,{valid:!0},"Sweet! that name is available"),i.a.createElement(d.a,null,"Sad! That name is already assigned or empty")))}class G extends i.a.Component{constructor(e,t){super(e,t),this.toggle=e=>{let t=e.target.name;this.setState({[t]:!this.state[t]})},this.handleInputChange=e=>{let t=e.target.name,a=e.target.value;const s=this.state.optionTypes[t];this.setState({formValues:Object(n.a)(Object(n.a)({},this.state.formValues),{},{[t]:a})});let i=!0,r="";"SizeSuffix"===s?(i=Object(C.q)(a),i||(r="The valid input is size( off | {unit}{metric} eg: 10G, 100M, 10G100M etc.)")):"Duration"===s?(i=Object(C.o)(a),i||(r="The valid input is time ({unit}{metric} eg: 10ms, 100m, 10h15ms etc.)")):"int"===s&&(i=Object(C.p)(a),i||(r="The valid input is int (100,200,300 etc)")),!this.state.required[t]||a&&""!==a||(i=!1,i||(r+=" This field is required")),this.setState(e=>({isValid:Object(n.a)(Object(n.a)({},e.isValid),{},{[t]:i}),formErrors:Object(n.a)(Object(n.a)({},e.formErrors),{},{[t]:r})}))},this.changeDriveType=(e,t)=>{let{newValue:a}=t;const{providers:n}=this.props;let s=a,i={},r={},o={},l={},c={};if(void 0!==s&&""!==s){const e=Object(C.f)(n,s);void 0!==e&&e.Options.forEach(e=>{const{DefaultStr:t,Type:a,Name:n,Required:s,Hide:d}=e;0===d&&(i[n]=t,r[n]=a,c[n]=s,o[n]=!(s&&(!t||""===t)),l[n]="")}),this.setState({drivePrefix:s,formValues:i,optionTypes:r,isValid:o,formErrors:l,required:c})}else this.setState({drivePrefix:s})},this.openSetupDrive=e=>{e&&e.preventDefault(),this.setState({colSetup:!0})},this.editAdvancedOptions=e=>{this.setState({advancedOptions:!this.state.advancedOptions})},this.clearForm=e=>{this.setState({driveName:"",drivePrefix:""})},this.changeName=e=>{const{driveNameIsEditable:t}=this.state,a=e.target.value;t&&Object(C.n)(a)?this.setState({driveName:a},()=>{void 0===a||""===a?this.setState({driveNameIsValid:!1}):j.a.post(q.a.getConfigForRemote,{name:a}).then(e=>{let t=this.state.formErrors,a=Object(C.j)(e.data);t.driveName=a?"":"Duplicate",this.setState({formErrors:t,driveNameIsValid:a})})}):this.setState(e=>({formErrors:Object(n.a)(Object(n.a)({},e.formErrors),{},{driveName:"Cannot edit name"})}))},this.openAdvancedSettings=e=>{this.state.advancedOptions?this.setState({colAdvanced:!0}):this.configEndDiv.scrollIntoView({behavior:"smooth"})},this.gotoNextStep=()=>{const{currentStepNumber:e,advancedOptions:t}=this.state;t&&3===e||!t&&2===e?this.handleSubmit(null):this.setCurrentStep(e+1)},this.gotoPrevStep=()=>{const{currentStepNumber:e}=this.state;this.setCurrentStep(e-1)},this.setCurrentStep=e=>{this.setState({currentStepNumber:e})},this.StepShowCase=e=>{let{currentStepNumber:t}=e;const a=["Set up Remote Config","Set up Drive","Advanced Config"];return i.a.createElement(u.a,{className:"timeline"},i.a.createElement(h.a,null,a.map((e,n)=>(n+=1,i.a.createElement(i.a.Fragment,{key:n},i.a.createElement(l.a,{className:"text-center "+(t===n?"step-active":""),md:2,sm:4},i.a.createElement("button",{className:"btn btn-step-count",onClick:()=>this.setCurrentStep(n)},n),i.a.createElement("h4",null,e)),n!==a.length&&i.a.createElement(l.a,{md:3,className:"d-none d-md-block"},i.a.createElement("div",{className:"timeline-divider align-middle"})))))))},this.state={colRconfig:!0,colSetup:!1,colAdvanced:!1,driveName:"",driveNameIsEditable:!0,advancedOptions:!1,formValues:{},formValuesValid:{},required:{},authModalIsVisible:!1,drivePrefix:"",driveNameIsValid:!1,formErrors:{driveName:""},optionTypes:{},isValid:{},currentStepNumber:1},this.configCheckInterval=null,this.handleSubmit=this.handleSubmit.bind(this),this.toggleAuthModal=this.toggleAuthModal.bind(this),this.startAuthentication=this.startAuthentication.bind(this),this.checkConfigStatus=this.checkConfigStatus.bind(this)}async checkConfigStatus(){const{driveName:e}=this.state;try{let t=await j.a.post(q.a.getConfigForRemote,{name:e});Object(C.j)(t.data)||(clearInterval(this.configCheckInterval),this.configCheckInterval=null,this.toggleAuthModal(),this.props.history.push("/dashboard"))}catch(t){M.b.error("Error creating config. ".concat(t),{autoClose:!1})}}validateForm(){const{driveNameIsValid:e,drivePrefix:t,isValid:a}=this.state;let n=!0;e||(n=!1),""===t&&(n=!1);for(const[s,i]of Object.entries(a))if(!s||!i){n=!1;break}return n}toggleAuthModal(){this.setState((e,t)=>({authModalIsVisible:!e.authModalIsVisible}))}startAuthentication(){this.toggleAuthModal(),null===this.configCheckInterval?this.configCheckInterval=setInterval(this.checkConfigStatus,D.f):console.error("Interval already running. Should not start a new one")}stopAuthentication(){this.setState((e,t)=>({authModalIsVisible:!1})),clearInterval(this.configCheckInterval)}async handleSubmit(e){e&&e.preventDefault();const{formValues:t,drivePrefix:a}=this.state,{providers:n}=this.props;if(this.validateForm()){if(void 0!==a&&""!==a){const e=Object(C.f)(n,a);if(void 0!==e){const a=e.Options;let n={};for(const[e,s]of Object.entries(t)){if("token"===e){n[e]=s;continue}const t=a.find((t,a,n)=>e===t.Name);if(t){const{DefaultStr:a}=t;s!==a&&(n[e]=s)}}let i={parameters:n,name:this.state.driveName,type:this.state.drivePrefix};this.startAuthentication();try{const{drivePrefix:e}=this.props.match.params;e?(await j.a.post(q.a.updateConfig,i),M.b.info("Config Updated")):(await j.a.post(q.a.createConfig,i),M.b.info("Config created"))}catch(s){M.b.error("Error creating config. ".concat(s),{autoClose:!1}),this.stopAuthentication()}}}}else M.b.warn("Check for errors before submitting.",{autoClose:!1})}componentDidMount(){const{drivePrefix:e}=this.props.match.params;(!this.props.providers||this.props.providers.length<1)&&this.props.getProviders(),e&&(this.setState({driveName:e,driveNameIsValid:!0,driveNameIsEditable:!1}),j.a.post(q.a.getConfigForRemote,{name:e}).then(e=>{console.log(e),this.changeDriveType(void 0,{newValue:e.data.type}),this.setState(t=>({formValues:Object(n.a)(Object(n.a)({},t.formValues),e.data)}))}))}componentWillUnmount(){clearInterval(this.configCheckInterval),this.configCheckInterval=null}render(){const{drivePrefix:e,advancedOptions:t,driveName:a,driveNameIsValid:n,currentStepNumber:s}=this.state,{providers:d}=this.props;return i.a.createElement("div",{"data-test":"newDriveComponent"},i.a.createElement(N.a,null,i.a.createElement("p",null,"This 3 step process will guide you through creating a new config. For auto config, leave the parameters as it is."),i.a.createElement(this.StepShowCase,{currentStepNumber:s}),i.a.createElement(m.a,{isOpen:1===s},i.a.createElement(p.a,null,i.a.createElement(g.a,null,i.a.createElement(H,{label:"Name of this drive (For your reference)",changeHandler:this.changeName,value:a,placeholder:"Enter a name",name:"name",id:"driveName",isValid:n}),i.a.createElement(r.a,{row:!0},i.a.createElement(o.a,{for:"driveType",sm:5},"Select"),i.a.createElement(l.a,{sm:7},i.a.createElement(T,{suggestions:d,value:e,onChange:this.changeDriveType}))),i.a.createElement(r.a,{row:!0},i.a.createElement(l.a,{sm:3},i.a.createElement(o.a,{for:"inputDriveName"},"Docs are available at ")," ",i.a.createElement("a",{href:"https://rclone.org/commands/rclone_config/"},"Rclone Config"))),i.a.createElement("div",{className:"clearfix"},i.a.createElement("div",{className:"float-right"},i.a.createElement(f.a,{className:"ml-3 btn-blue",onClick:this.gotoNextStep},"Next")))))),i.a.createElement(m.a,{isOpen:2===s},i.a.createElement(p.a,null,i.a.createElement(g.a,null,i.a.createElement(F,{drivePrefix:e,loadAdvanced:!1,changeHandler:this.handleInputChange,errorsMap:this.state.formErrors,isValidMap:this.state.isValid,currentValues:this.state.formValues,config:d}),i.a.createElement("div",{className:"clearfix"},i.a.createElement("div",{className:"float-right"},i.a.createElement(c.a,{type:"checkbox",value:t,onChange:this.editAdvancedOptions}),i.a.createElement("span",{className:"mr-3"},"Edit Advanced Options"),i.a.createElement(f.a,{className:"btn-no-background",onClick:this.gotoPrevStep},"Go back"),i.a.createElement(f.a,{className:"ml-3 btn-blue",onClick:this.gotoNextStep},"Next")))))),i.a.createElement(m.a,{isOpen:3===s},i.a.createElement(p.a,null,i.a.createElement(g.a,null,i.a.createElement(F,{drivePrefix:e,loadAdvanced:!0,changeHandler:this.handleInputChange,errorsMap:this.state.formErrors,isValidMap:this.state.isValid,currentValues:this.state.formValues,config:d}),i.a.createElement("div",{className:"clearfix"},i.a.createElement("div",{className:"float-right"},i.a.createElement(c.a,{type:"checkbox",value:t,onChange:this.editAdvancedOptions}),i.a.createElement("span",{className:"mr-3"},"Edit Advanced Options"),i.a.createElement(f.a,{className:"btn-no-background",onClick:this.gotoPrevStep},"Go back"),i.a.createElement(f.a,{className:"ml-3 btn-blue",onClick:this.gotoNextStep},"Next")))))),i.a.createElement(y,{isVisible:this.state.authModalIsVisible,closeModal:this.toggleAuthModal})))}}G.defaultProps={isEdit:!1};t.default=Object(R.b)(e=>({providers:e.config.providers}),{getProviders:A.b})(G)}}]);
//# sourceMappingURL=17.277a9d7e.chunk.js.map